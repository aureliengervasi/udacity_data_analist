# P6 - Make Effective Data Visualization


## Motivation

This work is part of the Udacity Data Analyst Nanoprogram. This is the final project for the Data Visualization course. The goal of this project is to use the D3.js library to design a "martini-glass' visualization from a chosen dataset. In my case, I choose to use the monthly TGV train line regularity statistics from the French railway company (SNCF).

## Dataset

The dataset used in this project has been extracted from the open data portal from the French railway company (SNCF). It consists in monthly statistics about the main high-speed train lines (TGV). More precisely, it details for each entry (1 entry per train line per month):
- Train line start station
- Train line end station
- Number of programmed trains
- Number of trains having traveled
- Number of trains canceled
- Number of trains delayed
- The associated regularity (percentage of programmed trains arrived on time)

Once cleaned from NaN values, the data set contains 2898 entries.

Source: https://data.sncf.com/

### Project structure

The SNCF data set is located under "/data/regularite-mensuelle-tgv.json". It is read by the Jupyter Notebook "SNCF.ipynb" which cleans and transforms it.

"index.html" host the D3.js visualization and uses 4 different files:
- "geojson/departements.geojson" is first used to draw the map of France with its d√©partements.
- "/data/villes.tsv" is then used to locate the main train stations that are to be represented on the map.
- "/geojson/tgv_lines.geojson" is used to draw the railway section paths on the map.
- finally, "/data/regularity.tsv" is used to read the monthly regularity statistics generated by the Python script.

Python version: v3.5.1

Pandas version: v0.17.1

D3.js version: v3

## Summary

### Design Decision

My idea was to draw a map of the main TGV lines in France, where my animation would modify the thickness of the different paths in order to translate a change in the monthly train regularity. So I had to deal with a continuous data type (train regularity, between 0% and 100%) on a map chart type.  

My visual encoding in this case would be the line thickness which would vary from very thin (if there is no train delay, or cancellation), to very thick. In a previous version, I also used the line opacity as a visual encoding, but after some feedback, I preferred to stay with only line thickness.

The overall visualization is based on a "martini-glass" scheme. The visualization begins with an animation that updates the map for each month between September 2011 and June 2016. At the end of this sequence, the user has the possibility to choose which specific month he wants to look at. Thanks to mouse-over events, it is also possible to get the exact regularity value on each train line section.

### Data preparation

As the original dataset provides train regularity for the entire train line (from departure station to end station), with one entry per way, I had to work first on the dataset to extract the data that I need. More precisely, I had to :
- drop NaN values
- group back and forth ways for each train line
- split train lines per railway section in order to get the train regularity for each section between the most important TGV stations. For example, the "Paris Est - Strasbourg" line had to be split between "Paris Est - Champagne-Ardenne TGV", "Champagne-Ardenne TGV - Lorraine TGV" and "Lorraine TGV - Strasbourg"
- group by date and by railway section. For example, 4 different train lines shared the "Paris Est - Champagne-Ardenne TGV" railway section.
- export the sections regularity statistics in a .tsv file to be processed by D3.js

### Message

The visualization should bring several messages:
- On average, train regularity is high on the TGV lines (89% on average)
- Disturbances can clearly be spotted with an increase of the path thickness
- These disturbances affect most of the time an entire axis (South-East, West, North or East)
- A few months show disturbances on all the line at the same time. In particular, June 2014 shows a reduced average train regularity on almost all the railway sections. After some external research, this is to be linked with a major strike that happened the same month.

## Limitations and potentials
- The SNCF data set does not seem to be complete. Some TGV lines seems to be missing (for instance: Lyon Part Dieu - Mulhouse)
- The train line paths are based on the TGV railway map (http://www.sncf.com/fr/trains/tgv/reseau). In order to focus my effort on the D3.js coding, I deliberately chose to simplify these paths, which explains the unlikely straight shapes of these lines. A deepened research on the geographic location of these railway lines would help to improve these shapes.
- For now, only the path thickness has been selected as a visual encoding. Using also a color palette could maybe help to highlight the disturbances.

## Feedback

In order to improve he first version of my visualization (index_old.html), I had it reviewed by 3 friends. The following [link](PNG/Capture_v1.PNG) gives an idea about the first version. Several observations have been made, which I used to develop further my project:
- "Varying path opacity and thickness produces lines that are sometimes difficult to see. They are too thin, and almost transparent." In fact, for regularity above 85% it was very difficult to see where the line is. As a consequence, I choose to only vary the line opacity, and I doubled the maximum thickness that can be reached.
- "With no legend explaining the line thickness scale, it is difficult to judge if what we see translates a strong disturbance or not."
- "But even with a legend, it would be nice to be able to get the exact value when my mouse is over the railway section."
- "I can see different circles that must represent cities, but I'm not sure to be able to name them correctly. Adding some text when the mouse is over it would help a lot."
- "Dates are provided in a strange format. It would be easier if the months name could be given in full letters."

## Bibliograpy

- Map of France in geojson: https://github.com/gregoiredavid/france-geojson
- SNCF Open Data portal: https://data.sncf.com/
- Mouse-over event example: http://bl.ocks.org/WilliamQLiu/76ae20060e19bf42d774
- Time formating example: http://learnjsdata.com/time.html
