# P6 - Make Effective Data Visualization


## Motivation

This work is part of the Udacity Data Analyst Nanoprogram. This is the final project for the Data Visualization course. The goal of this project is to use the D3.js library to design a "martini-glass' visualization from a chosen dataset. In my case, I choose to use the monthly TGV train line regularity statistics from the French railway company (SNCF).

## Dataset

The dataset used in this project has been extracted from the open data portal from the French railway company (SNCF). It consists in monthly statistics about the main high-speed train lines (TGV). More precisely, it details for each entry (1 entry per train line per month):
- Train line start station
- Train line end station
- Number of programmed trains
- Number of trains having traveled
- Number of trains canceled
- Number of trains delayed
- The associated regularity (percentage of programmed trains arrived on time)
- Observations about disturbances having caused train delays

Once cleaned from NaN values, the data set contains 2898 entries.

Source: https://data.sncf.com/

### Project structure

The SNCF data set is located under "/data/regularite-mensuelle-tgv.json". It is read by the Jupyter Notebook "SNCF.ipynb" which cleans and transforms it.

"index.html" host the D3.js visualization and uses 5 different files:
- "geojson/departements.geojson" is first used to draw the map of France with its d√©partements.
- "data/villes.tsv" is then used to locate the main train stations that are to be represented on the map.
- "geojson/tgv_lines.geojson" is used to draw the railway section paths on the map.
- "data/comments.tsv" is used to gather info about disturbances on the different train lines
- finally, "data/regularity.tsv" is used to read the monthly regularity statistics generated by the Python script.

Python version: v3.5.1

Pandas version: v0.17.1

D3.js version: v3

[Link to the HTML visualization](http://aureliengervasi.github.io/udacity_data_analist/P6/index.html)

## Summary

### Design Decision

My idea was to draw a map of the main TGV lines in France, where my animation would modify the color of the different paths in order to translate a change in the monthly train regularity. So I had to deal with a continuous data type (train regularity, between 0% and 100%) on a map chart type.  

My visual encoding in this case would be the stroke color which would vary from light rose (if there is no train delay, or cancellation), to red. This colors where chosen in order to be colorblind safe. In a previous version, I also used the line opacity and line thickness as a visual encoding, but after some feedback, I preferred to stay with only stroke color.

I also included the main disturbances statistics in order to see the correlation between train regularity and the different types of disturbances. The different observations related to each month are displayed below the map, if the user wants more details.

The overall visualization is based on a "martini-glass" scheme. The visualization begins with an animation that updates the map to January 2013, which is a good example of the impact of weather conditions on train regularity. The next animation brings the viewer to June 2014, where a lot of strikes occurred in the railway company. The last animation unrolls the remaining months until June 2016. At the end of this sequence, the user has the possibility to choose which specific month he wants to look at. Thanks to mouse-over events, it is also possible to get the exact regularity value on each train line section.

### Data preparation

As the original dataset provides train regularity for the entire train line (from departure station to end station), with one entry per way, I had to work first on the dataset to extract the data that I need. More precisely, I had to :
- drop NaN values
- group back and forth ways for each train line
- split train lines per railway section in order to get the train regularity for each section between the most important TGV stations. For example, the "Paris Est - Strasbourg" line had to be split between "Paris Est - Champagne-Ardenne TGV", "Champagne-Ardenne TGV - Lorraine TGV" and "Lorraine TGV - Strasbourg"
- group by date and by railway section. For example, 4 different train lines shared the "Paris Est - Champagne-Ardenne TGV" railway section.
- export the sections regularity statistics in a .tsv file to be processed by D3.js

In order to use the comments, I also had to identify which disturbance families are mentioned. I first had to identify key words related to these families and do a word-based search for each family on each entry. With this approach, I was for example able to estimate how many lines are concerned by animal-related disturbances each month.

### Message

The visualization should bring several messages:
- On average, train regularity is high on the TGV lines (89% on average)
- Disturbances can clearly be spotted with a change of the path color
- These disturbances affect most of the time an entire axis (South-East, West, North or East)
- Disturbances related to weather events or strikes tend to have a strong impact on train regularity
- As an example, certain months show disturbances on all the line at the same time. In particular, June 2014 shows a reduced average train regularity on almost all the railway sections. This is to be linked with a major strike that happened the same month.
- On the contrary, disturbances related to people are common and show a weaker effect on train regularity


## Limitations and potentials
- The SNCF data set does not seem to be complete. Some TGV lines seems to be missing (for instance: Lyon Part Dieu - Mulhouse)
- The train line paths are based on the TGV railway map (http://www.sncf.com/fr/trains/tgv/reseau). In order to focus my effort on the D3.js coding, I deliberately chose to simplify these paths, which explains the unlikely straight shapes of these lines. A deepened research on the geographic location of these railway lines would help to improve these shapes.
- Observations contained in the data set do not seem to be comprehensive. Moreover, as they are manually entered by different people, comments are not structured. As a consequence, it is difficult to extract precisely how many events happened during that month or what was their impact. A more detailed work of data wrangling could be done in order to get more precise insights from these observations.

## Feedback

In order to improve he first version of my visualization (index_old.html), I had it reviewed by 3 friends. The following [link](PNG/Capture_v1.PNG) gives an idea about the first version. Several observations have been made, which I used to develop further my project and which led to the [final version](http://aureliengervasi.github.io/udacity_data_analist/P6/index.html):
- "Varying path opacity and thickness produces lines that are sometimes difficult to see. They are too thin, and almost transparent." In fact, for regularity above 85% it was very difficult to see where the line is. As a consequence, I choose to only vary the line opacity, and I doubled the maximum thickness that can be reached.
- "With no legend explaining the line thickness scale, it is difficult to judge if what we see translates a strong disturbance or not."
- "But even with a legend, it would be nice to be able to get the exact value when my mouse is over the railway section."
- "I can see different circles that must represent cities, but I'm not sure to be able to name them correctly. Adding some text when the mouse is over it would help a lot."
- "Dates are provided in a strange format. It would be easier if the months name could be given in full letters."
- "The main message is not clear. The viewer needs more help during the animation phase.". As a consequence, I processed the observations from the dataset and extracted statistics about the different disturbances families. I also added the raw observation below the map, if more details are needed. A also split the animation in 3 different phases where each focuses on a specific message.

## Bibliograpy

- Map of France in geojson: https://github.com/gregoiredavid/france-geojson
- SNCF Open Data portal: https://data.sncf.com/
- Mouse-over event example: http://bl.ocks.org/WilliamQLiu/76ae20060e19bf42d774
- Time formating example: http://learnjsdata.com/time.html
- Colorblind safe palettes: http://colorbrewer2.org/
